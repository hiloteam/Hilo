/**
 * hilojs 2.0.1 for kissy
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
KISSY.add("hilo/loader/LoadQueue",function(e,r,o,n,t){function a(e){var r,o,n=/\/?[^\/]+\.(\w+)(\?\S+)?$/i;return(r=e.match(n))&&(o=r[1].toLowerCase()),o||null}var i=r.create({Mixes:o,constructor:function(e){this._source=[],this.add(e)},maxConnections:2,_source:null,_loaded:0,_connections:0,_currentIndex:-1,add:function(e){var r=this;return e&&(e=e instanceof Array?e:[e],r._source=r._source.concat(e)),r},get:function(e){if(e)for(var r=this._source,o=0;o<r.length;o++){var n=r[o];if(n.id===e||n.src===e)return n}return null},getContent:function(e){var r=this.get(e);return r&&r.content},removeContent:function(e){if(e)for(var r=this._source,o=0;o<r.length;o++){var n=r[o];if(n.id===e||n.src===e)return void r.splice(o,1)}},start:function(){var e=this;return e._loadNext(),e},_loadNext:function(){var e=this,r=e._source,o=r.length;if(e._loaded>=o)return void e.fire("complete");if(e._currentIndex<o-1&&e._connections<e.maxConnections){var n=++e._currentIndex,t=r[n],a=e._getLoader(t);if(a){var i=a.onLoad,c=a.onError;a.onLoad=function(r){a.onLoad=i,a.onError=c;var o=i&&i.call(a,r)||r.target;e._onItemLoad(n,o)},a.onError=function(r){a.onLoad=i,a.onError=c,c&&c.call(a,r),e._onItemError(n,r)},e._connections++}e._loadNext(),a&&a.load(t)}},_getLoader:function(e){var r=e.loader;if(r)return r;var o=e.type||a(e.src);switch(o){case"png":case"jpg":case"jpeg":case"gif":case"webp":r=new n;break;case"js":case"jsonp":r=new t}return r},_onItemLoad:function(e,r){var o=this,n=o._source[e];n.loaded=!0,n.content=r,o._connections--,o._loaded++,o.fire("load",n),o._loadNext()},_onItemError:function(e,r){var o=this,n=o._source[e];n.error=r,o._connections--,o._loaded++,o.fire("error",n),o._loadNext()},getSize:function(e){for(var r=0,o=this._source,n=0;n<o.length;n++){var t=o[n];r+=(e?t.loaded&&t.size:t.size)||0}return r},getLoaded:function(){return this._loaded},getTotal:function(){return this._source.length}});return i},{requires:["hilo/core/Class","hilo/event/EventMixin","hilo/loader/ImageLoader","hilo/loader/ScriptLoader"]});