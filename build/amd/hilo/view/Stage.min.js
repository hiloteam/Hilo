/**
 * Hilo 1.0.0 for amd
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
define("hilo/view/Stage",["hilo/core/Hilo","hilo/core/Class","hilo/view/Container","hilo/renderer/CanvasRenderer","hilo/renderer/DOMRenderer","hilo/renderer/WebGLRenderer"],function(e,t,n,i,r,s){var a=t.create({Extends:n,constructor:function(t){t=t||{},this.id=this.id||t.id||e.getUid("Stage"),a.superclass.constructor.call(this,t),this._initRenderer(t);var n=this.width,i=this.height,r=this.updateViewport();t.width||(n=r&&r.width||320),t.height||(i=r&&r.height||480),this.resize(n,i,!0)},canvas:null,renderer:null,paused:!1,viewport:null,_initRenderer:function(t){var n=t.canvas,a=t.container,o=t.renderType||"canvas";if("string"==typeof n&&(n=e.getElement(n)),"string"==typeof a&&(a=e.getElement(a)),n)n.getContext||(o="dom");else{var h="dom"===o?"div":"canvas";n=e.createElement(h,{style:{position:"absolute"}})}this.canvas=n,a&&a.appendChild(n);var d={canvas:n,stage:this};switch(o){case"dom":this.renderer=new r(d);break;case"webgl":s.isSupport()?this.renderer=new s(d):this.renderer=new i(d);break;case"canvas":default:this.renderer=new i(d)}},addTo:function(e){var t=this.canvas;return t.parentNode!==e&&e.appendChild(t),this},tick:function(e){this.paused||this._render(this.renderer,e)},enableDOMEvent:function(e,t){for(var n=this,i=n.canvas,r="string"==typeof e?[e]:e,t=t!==!1,s=n._domListener||(n._domListener=function(e){n._onDOMEvent(e)}),a=0;a<r.length;a++){var e=r[a];t?i.addEventListener(e,s,!1):i.removeEventListener(e,s)}return n},_onDOMEvent:function(t){var n=t.type,i=t,r=0==n.indexOf("touch"),s=t;if(r){var a=t.touches,o=t.changedTouches;s=a&&a.length?a[0]:o&&o.length?o[0]:null}var h=s.pageX||s.clientX,d=s.pageY||s.clientY,c=this.viewport||this.updateViewport();i.stageX=h=(h-c.left)/this.scaleX,i.stageY=d=(d-c.top)/this.scaleY,i.stopPropagation=function(){this._stopPropagationed=!0};var u=this.getViewAtPoint(h,d,!0,!1,!0)||this,v=this.canvas,l=this._eventTarget,p="mouseout"===n;if(l&&(l!=u&&(!l.contains||!l.contains(u))||p)){var g="touchmove"===n?"touchout":"mousemove"===n||p||!u?"mouseout":null;if(g){var f=e.copy({},i);f.type=g,f.eventTarget=l,l._fireMouseEvent(f)}i.lastEventTarget=l,this._eventTarget=null}if(u&&u.pointerEnabled&&"mouseout"!==n&&(i.eventTarget=this._eventTarget=u,u._fireMouseEvent(i)),!r){var w=u&&u.pointerEnabled&&u.useHandCursor?"pointer":"";v.style.cursor=w}e.browser.android&&"touchmove"===n&&t.preventDefault()},updateViewport:function(){var t=this.canvas,n=null;return t.parentNode&&(n=this.viewport=e.getElementRect(t)),n},resize:function(e,t,n){(n||this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.renderer.resize(e,t),this.updateViewport())}});return a});