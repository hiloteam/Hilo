/**
 * Hilo 1.0.0 for amd
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
define("hilo/view/Text",["hilo/core/Class","hilo/core/Hilo","hilo/view/View","hilo/view/CacheMixin"],function(t,e,i,n){var o=t.create({Extends:i,Mixes:n,constructor:function(t){t=t||{},this.id=this.id||t.id||e.getUid("Text"),o.superclass.constructor.call(this,t),t.font||(this.font="12px arial"),this._fontHeight=o.measureFontHeight(this.font)},text:null,color:"#000",textAlign:null,textVAlign:null,outline:!1,lineSpacing:0,maxWidth:200,font:null,textWidth:0,textHeight:0,setFont:function(t){var e=this;return e.font!==t&&(e.font=t,e._fontHeight=o.measureFontHeight(t)),e},render:function(t,e){var i=this;t.canvas;if("canvas"===t.renderType)i._draw(t.context);else if("dom"===t.renderType){var n=i.drawable,o=n.domElement,h=o.style;h.font=i.font,h.textAlign=i.textAlign,h.color=i.color,h.width=i.width+"px",h.height=i.height+"px",h.lineHeight=i._fontHeight+i.lineSpacing+"px",o.innerHTML=i.text,t.draw(this)}else i.cache(),t.draw(i)},_draw:function(t){var e=this,i=e.text.toString();if(i){t.font=e.font,t.textAlign=e.textAlign,t.textBaseline="top";var n,o,h,r,l,a=i.split(/\r\n|\r|\n|<br(?:[ \/])*>/),s=0,c=0,d=e._fontHeight+e.lineSpacing,x=[];for(n=0,r=a.length;r>n;n++)if(o=a[n],h=t.measureText(o).width,h<=e.maxWidth)x.push({text:o,y:c}),h>s&&(s=h),c+=d;else{var g,f,u,w="",v=0;for(f=0,l=o.length;l>f;f++)u=o[f],g=t.measureText(w+u).width,g>e.maxWidth?(x.push({text:w,y:c}),v>s&&(s=v),c+=d,w=u):(v=g,w+=u),f==l-1&&(x.push({text:w,y:c}),w!==u&&g>s&&(s=g),c+=d)}e.textWidth=s,e.textHeight=c,e.width||(e.width=s),e.height||(e.height=c);var m=0;switch(e.textVAlign){case"middle":m=e.height-e.textHeight>>1;break;case"bottom":m=e.height-e.textHeight}var p=e.background;p&&(t.fillStyle=p,t.fillRect(0,0,e.width,e.height)),e.outline?t.strokeStyle=e.color:t.fillStyle=e.color;for(var n=0;n<x.length;n++){var o=x[n];e._drawTextLine(t,o.text,m+o.y)}}},_drawTextLine:function(t,e,i){var n=this,o=0,h=n.width;switch(n.textAlign){case"center":o=h>>1;break;case"right":case"end":o=h}n.outline?t.strokeText(e,o,i):t.fillText(e,o,i)},Statics:{measureFontHeight:function(t){var i,n=document.documentElement,o=e.createElement("div",{style:{font:t,position:"absolute"},innerHTML:"M"});return n.appendChild(o),i=o.offsetHeight,n.removeChild(o),i}}});return o});