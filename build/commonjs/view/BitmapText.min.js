/**
 * Hilo 1.0.1 for commonjs
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
var Class=require("../core/Class"),Hilo=require("../core/Hilo"),Container=require("./Container"),Bitmap=require("./Bitmap"),BitmapText=Class.create({Extends:Container,constructor:function(t){t=t||{},this.id=this.id||t.id||Hilo.getUid("BitmapText"),BitmapText.superclass.constructor.call(this,t);var e=t.text+"";e&&(this.text="",this.setText(e)),this.pointerChildren=!1},glyphs:null,letterSpacing:0,text:"",textAlign:"left",setText:function(t){var e=this,i=t.toString(),r=i.length;if(e.text!=i){e.text=i;var a,n,h,s,l=0,o=0,c=0;for(a=0;a<r;a++)n=i.charAt(a),h=e.glyphs[n],h&&(c=l+(l>0?e.letterSpacing:0),e.children[a]?(s=e.children[a],s.setImage(h.image,h.rect)):(s=e._createBitmap(h),e.addChild(s)),s.x=c,l=c+h.rect[2],o=Math.max(o,h.rect[3]));for(a=e.children.length-1;a>=r;a--)e._releaseBitmap(e.children[a]),e.children[a].removeFromParent();return e.width=l,e.height=o,this.setTextAlign(),e}},_createBitmap:function(t){var e;return BitmapText._pool.length?(e=BitmapText._pool.pop(),e.setImage(t.image,t.rect)):e=new Bitmap({image:t.image,rect:t.rect}),e},_releaseBitmap:function(t){BitmapText._pool.push(t)},setTextAlign:function(t){switch(this.textAlign=t||this.textAlign,this.textAlign){case"center":this.pivotX=.5*this.width;break;case"right":this.pivotX=this.width;break;case"left":default:this.pivotX=0}return this},hasGlyphs:function(t){var e=this.glyphs;if(!e)return!1;var i,t=t.toString(),r=t.length;for(i=0;i<r;i++)if(!e[t.charAt(i)])return!1;return!0},Statics:{_pool:[],createGlyphs:function(t,e,i,r){var a=t.toString();i=i||a.length,r=r||1;for(var n=e.width/i,h=e.height/r,s={},l=0,o=t.length;l<o;l++)charStr=a.charAt(l),s[charStr]={image:e,rect:[n*(l%i),h*Math.floor(l/i),n,h]};return s}}});module.exports=BitmapText;