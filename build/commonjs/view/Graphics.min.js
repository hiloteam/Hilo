/**
 * Hilo 1.0.1 for commonjs
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
var Hilo=require("../core/Hilo"),Class=require("../core/Class"),View=require("./View"),CacheMixin=require("./CacheMixin"),Graphics=function(){var i=document.createElement("canvas"),l=i.getContext&&i.getContext("2d");return Class.create({Extends:View,Mixes:CacheMixin,constructor:function(i){i=i||{},this.id=this.id||i.id||Hilo.getUid("Graphics"),Graphics.superclass.constructor.call(this,i),this._actions=[]},lineWidth:1,lineAlpha:1,lineCap:null,lineJoin:null,miterLimit:10,hasStroke:!1,strokeStyle:"0",hasFill:!1,fillStyle:"0",fillAlpha:0,lineStyle:function(i,l,t,e,a,n){var r=this,c=r._addAction;return c.call(r,["lineWidth",r.lineWidth=i||1]),c.call(r,["strokeStyle",r.strokeStyle=l||"0"]),c.call(r,["lineAlpha",r.lineAlpha=t||1]),void 0!=e&&c.call(r,["lineCap",r.lineCap=e]),void 0!=a&&c.call(r,["lineJoin",r.lineJoin=a]),void 0!=n&&c.call(r,["miterLimit",r.miterLimit=n]),r.hasStroke=!0,r},beginFill:function(i,l){var t=this,e=t._addAction;return e.call(t,["fillStyle",t.fillStyle=i]),e.call(t,["fillAlpha",t.fillAlpha=l||1]),t.hasFill=!0,t},endFill:function(){var i=this,l=i._addAction;return i.hasStroke&&l.call(i,["stroke"]),i.hasFill&&l.call(i,["fill"]),i.setCacheDirty(!0),i},beginLinearGradientFill:function(i,t,e,a,n,r){for(var c=this,o=l.createLinearGradient(i,t,e,a),s=0,h=n.length;s<h;s++)o.addColorStop(r[s],n[s]);return c.hasFill=!0,c._addAction(["fillStyle",c.fillStyle=o])},beginRadialGradientFill:function(i,t,e,a,n,r,c,o){for(var s=this,h=l.createRadialGradient(i,t,e,a,n,r),d=0,u=c.length;d<u;d++)h.addColorStop(o[d],c[d]);return s.hasFill=!0,s._addAction(["fillStyle",s.fillStyle=h])},beginBitmapFill:function(i,t){var e=this,a=l.createPattern(i,t||"");return e.hasFill=!0,e._addAction(["fillStyle",e.fillStyle=a])},beginPath:function(){return this._addAction(["beginPath"])},closePath:function(){return this._addAction(["closePath"])},moveTo:function(i,l){return this._addAction(["moveTo",i,l])},lineTo:function(i,l){return this._addAction(["lineTo",i,l])},quadraticCurveTo:function(i,l,t,e){return this._addAction(["quadraticCurveTo",i,l,t,e])},bezierCurveTo:function(i,l,t,e,a,n){return this._addAction(["bezierCurveTo",i,l,t,e,a,n])},drawRect:function(i,l,t,e){return this._addAction(["rect",i,l,t,e])},drawRoundRectComplex:function(i,l,t,e,a,n,r,c){var o=this,s=o._addAction;return s.call(o,["moveTo",i+a,l]),s.call(o,["lineTo",i+t-n,l]),s.call(o,["arc",i+t-n,l+n,n,-Math.PI/2,0,!1]),s.call(o,["lineTo",i+t,l+e-r]),s.call(o,["arc",i+t-r,l+e-r,r,0,Math.PI/2,!1]),s.call(o,["lineTo",i+c,l+e]),s.call(o,["arc",i+c,l+e-c,c,Math.PI/2,Math.PI,!1]),s.call(o,["lineTo",i,l+a]),s.call(o,["arc",i+a,l+a,a,Math.PI,3*Math.PI/2,!1]),o},drawRoundRect:function(i,l,t,e,a){return this.drawRoundRectComplex(i,l,t,e,a,a,a,a)},drawCircle:function(i,l,t){return this._addAction(["arc",i+t,l+t,t,0,2*Math.PI,0])},drawEllipse:function(i,l,t,e){var a=this;if(t==e)return a.drawCircle(i,l,t);var n=a._addAction,r=t/2,c=e/2,o=.5522847498307933,s=o*r,h=o*c;return i+=r,l+=c,n.call(a,["moveTo",i+r,l]),n.call(a,["bezierCurveTo",i+r,l-h,i+s,l-c,i,l-c]),n.call(a,["bezierCurveTo",i-s,l-c,i-r,l-h,i-r,l]),n.call(a,["bezierCurveTo",i-r,l+h,i-s,l+c,i,l+c]),n.call(a,["bezierCurveTo",i+s,l+c,i+r,l+h,i+r,l]),a},drawSVGPath:function(i){var l=this,t=l._addAction,e=i.split(/,| (?=[a-zA-Z])/);t.call(l,["beginPath"]);for(var a=0,n=e.length;a<n;a++){var r=e[a],c=r[0].toUpperCase(),o=r.substring(1).split(/,| /);switch(0==o[0].length&&o.shift(),c){case"M":t.call(l,["moveTo",o[0],o[1]]);break;case"L":t.call(l,["lineTo",o[0],o[1]]);break;case"C":t.call(l,["bezierCurveTo",o[0],o[1],o[2],o[3],o[4],o[5]]);break;case"Z":t.call(l,["closePath"])}}return l},_draw:function(i){var l,t=this,e=t._actions,a=e.length;for(i.beginPath(),l=0;l<a;l++){var n=e[l],r=n[0],c=n.length>1?n.slice(1):null;"function"==typeof i[r]?i[r].apply(i,c):i[r]=n[1]}},render:function(i,l){var t=this;i.canvas;"canvas"===i.renderType?t._draw(i.context):(t.cache(),i.draw(t))},clear:function(){var i=this;return i._actions.length=0,i.lineWidth=1,i.lineAlpha=1,i.lineCap=null,i.lineJoin=null,i.miterLimit=10,i.hasStroke=!1,i.strokeStyle="0",i.hasFill=!1,i.fillStyle="0",i.fillAlpha=1,i.setCacheDirty(!0),i},_addAction:function(i){var l=this;return l._actions.push(i),l}})}();module.exports=Graphics;