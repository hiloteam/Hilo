/**
 * Hilo 1.0.2 for commonjs
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
var Hilo=require("..coreHilo"),Class=require("..coreClass"),EventMixin=require("..eventEventMixin"),Matrix=require("..geomMatrix"),View=function(){function t(t,e,i){for(var r,n,o,a,s=0,h=!1,u=0,y=i.length;u<y;u++){var l=i[u],x=i[(u+1)%y];if(l.y==x.y&&e==l.y&&(l.x>x.x?(r=x.x,n=l.x):(r=l.x,n=x.x),t>=r&&t<=n))h=!0;else if(l.y>x.y?(o=x.y,a=l.y):(o=l.y,a=x.y),!(e<o||e>a)){var d=(e-l.y)*(x.x-l.x)/(x.y-l.y)+l.x;if(d>t?s++:d==t&&(h=!0),l.x>t&&l.y==e){var v=i[(y+u-1)%y];(v.y<e&&x.y>e||v.y>e&&x.y<e)&&s++}}}return h||s%2==1}function e(t,e){var r=i(t,e,{overlap:-(1/0),normal:{x:0,y:0}});return!!r&&i(e,t,r)}function i(t,e,i){for(var r,n,o,a,s,h,u,y,l,x=t.length,d=e.length,v={x:0,y:0},c=0;c<x;c++){r=t[c],n=t[c<x-1?c+1:0],v.x=r.y-n.y,v.y=n.x-r.x,o=Math.sqrt(v.x*v.x+v.y*v.y),v.x/=o,v.y/=o,a=s=t[0].x*v.x+t[0].y*v.y;for(var f=1;f<x;f++)y=t[f].x*v.x+t[f].y*v.y,y>s?s=y:y<a&&(a=y);for(h=u=e[0].x*v.x+e[0].y*v.y,f=1;f<d;f++)y=e[f].x*v.x+e[f].y*v.y,y>u?u=y:y<h&&(h=y);if(a<h?(l=h-s,v.x=-v.x,v.y=-v.y):l=a-u,l>=0)return!1;l>i.overlap&&(i.overlap=l,i.normal.x=v.x,i.normal.y=v.y)}return i}return Class.create({Mixes:EventMixin,constructor:function(t){t=t||{},this.id=this.id||t.id||Hilo.getUid("View"),Hilo.copy(this,t,!0)},tint:16777215,id:null,x:0,y:0,width:0,height:0,alpha:1,rotation:0,visible:!0,pivotX:0,pivotY:0,scaleX:1,scaleY:1,pointerEnabled:!0,background:null,mask:null,align:null,drawable:null,boundsArea:null,parent:null,depth:-1,getStage:function(){for(var t,e=this;t=e.parent;)e=t;return e.canvas?e:null},getScaledWidth:function(){return this.width*this.scaleX},getScaledHeight:function(){return this.height*this.scaleY},addTo:function(t,e){return"number"==typeof e?t.addChildAt(this,e):t.addChild(this),this},removeFromParent:function(){var t=this.parent;return t&&t.removeChild(this),this},getBounds:function(){for(var t,e,i,r,n,o,a,s=this.width,h=this.height,u=this.getConcatenatedMatrix(),y=this.boundsArea||[{x:0,y:0},{x:s,y:0},{x:s,y:h},{x:0,y:h}],l=[],x=0,d=y.length;x<d;x++)t=u.transformPoint(y[x],!0,!0),e=t.x,i=t.y,0==x?(r=n=e,o=a=i):(r>e?r=e:n<e&&(n=e),o>i?o=i:a<i&&(a=i)),l[x]=t;return l.x=r,l.y=o,l.width=n-r,l.height=a-o,l},getConcatenatedMatrix:function(t){for(var e=new Matrix(1,0,0,1,0,0),i=this;i!=t&&i.parent;i=i.parent){var r=1,n=0,o=i.rotation%360,a=i.pivotX,s=i.pivotY,h=i.scaleX,u=i.scaleY;if(o){var y=o*Math.PI/180;r=Math.cos(y),n=Math.sin(y)}0!=a&&(e.tx-=a),0!=s&&(e.ty-=s),e.concat(r*h,n*h,-n*u,r*u,i.x,i.y)}return e},hitTestPoint:function(e,i,r){var n=this.getBounds(),o=e>=n.x&&e<=n.x+n.width&&i>=n.y&&i<=n.y+n.height;return o&&r&&(o=t(e,i,n)),o},hitTestObject:function(t,i){var r=this.getBounds(),n=t.getBounds(),o=r.x<=n.x+n.width&&n.x<=r.x+r.width&&r.y<=n.y+n.height&&n.y<=r.y+r.height;return o&&i&&(o=e(r,n)),!!o},_render:function(t,e){this.onUpdate&&this.onUpdate(e)===!1||!t.startDraw(this)||(t.transform(this),this.render(t,e),t.endDraw(this))},_fireMouseEvent:function(t){if(t.eventCurrentTarget=this,this.fire(t),"mousemove"==t.type){if(!this.__mouseOver){this.__mouseOver=!0;var e=Hilo.copy({},t);e.type="mouseover",this.fire(e)}}else"mouseout"==t.type&&(this.__mouseOver=!1);var i=this.parent;t._stopped||t._stopPropagationed||!i||("mouseout"==t.type||"touchout"==t.type?i.hitTestPoint(t.stageX,t.stageY,!0)||i._fireMouseEvent(t):i._fireMouseEvent(t))},onUpdate:null,render:function(t,e){t.draw(this)},toString:function(){return Hilo.viewToString(this)}})}();module.exports=View;